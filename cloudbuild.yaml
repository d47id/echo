steps:
- name: 'gcr.io/cloud-builders/docker'
  entrypoint: 'sh'
  args:
  - '-c'
  - >-
    docker
    pull
    gcr.io/$PROJECT_ID/$_APP_NAME-builder:latest
- name: 'gcr.io/cloud-builders/docker'
  entrypoint: 'sh'
  args:
  - '-c'
  - >-
    docker
    build
    --tag
    gcr.io/$PROJECT_ID/$_APP_NAME:$TAG_NAME
    --tag
    gcr.io/$PROJECT_ID/$_APP_NAME:latest
    --cache-from
    gcr.io/$PROJECT_ID/$_APP_NAME-builder:latest
    --build-arg
    VERSION=$TAG_NAME
    --build-arg
    BUILD_TIME=$(date -u '+%Y-%m-%dT%H:%M:%SZ')
    --build-arg
    BRANCH=$BRANCH_NAME
    --build-arg
    COMMIT=$COMMIT_SHA .
images:
- 'gcr.io/$PROJECT_ID/$_APP_NAME:$TAG_NAME'
